\section{Patterns 6 - Redegør for følgende concurrency mønstre}

\subsection{Fokuspunkter}

\begin{itemize}
	\item Parallel Loops.
	\item Parallel Tasks.
\end{itemize}

\subsubsection{Parallel loops}

Parallel loops pattern minder meget om et almindeligt loop. Der udføres samme operation hvor hvert element for et givet antal gange. Forskellen er dog at et almindeligt loop sker sekventielt, hvorimod et parallelt loop ofte udfører steps parallelt. Når man bruger parallelle loops er det derfor vigtigt at sikre sig at iterationerne ikke er afhængige af hinanden.

Eksempel på almindeligt for loop:

\begin{lstlisting}[caption=Normal for loop, label=code:normalLoop]
for (int i = 0; i < n; i++)
{
	//Do stuff...
}
\end{lstlisting}

Eksempel på parallelt for loop:

\begin{lstlisting}[caption=Parallel for loop, label=code:paraLoop]
Parallel.For (0, n, i =>
{
	//Do stuff...
});
\end{lstlisting}

For Each løkken kan også køres parallelt:

\begin{lstlisting}[caption=Parallelt for each loop, label=paraForEach]
string[] navne = { "Torben", "Birger", "Niels" };

Parallel.ForEach(navne, navn =>
{
	Console.WriteLine(navn);
});
\end{lstlisting}

Det er Task Parallel Library der står for at håndtere threading, og man skal derfor ikke selv sørge for at fordele opgaven til CPU'en. 

\paragraph{Hvornår giver det mening med PL?}
\begin{itemize}
	\item Som sagt kan det kun bruges hvor iterationerne ikke er afhængige af hinanden!
	\item Brug når iterationer ikke tilgår samme memory/filer
	\item Brugbart hvor der laves blokerende kald (skriv/læs til fil)
	\item Brugbart når beregninger kan spredes ud på flere kerner.
\end{itemize}

Trådhåndtering giver overhead på et parallelt loop, og derfor kan meget små iteraationer blive kvalt heri.

TPL håndterer partitionering, thread scheduling af tråde i threadPool'en og generelt alle low-level details.

\subsubsection{Parallel tasks}

En task er ikke en tråd! En task er en opgave som udføres sekventielt.\\

Vi kan bruge TPL biblioteket til at køre disse tasks parallelt.